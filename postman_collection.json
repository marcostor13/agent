{
	"info": {
		"_postman_id": "7a8d9e2b-1c3d-4e5f-8g7h-9i0j1k2l3m4n",
		"name": "AI Sales Agent - Multi-Account",
		"description": "Colección de APIs para el Agente de Ventas IA con soporte multi-cuenta, integración de WhatsApp, Catálogo RAG y gestión de pedidos.",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "General",
			"item": [
				{
					"name": "Root Check",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}",
							"host": [
								"{{baseUrl}}"
							]
						},
						"description": "Verifica que el servidor principal esté respondiendo."
					},
					"response": []
				},
				{
					"name": "Health Check",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/health",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"health"
							]
						},
						"description": "Verifica el estado de salud del servidor y el tamaño del catálogo de productos."
					},
					"response": []
				}
			]
		},
		{
			"name": "WhatsApp Configuration",
			"item": [
				{
					"name": "Create Config",
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"name\": \"Tienda Demo\",\n    \"phoneNumber\": \"51900111222\",\n    \"phoneNumberId\": \"1234567890\",\n    \"verifyToken\": \"tokentest\",\n    \"accessToken\": \"EAAB...\",\n    \"apiVersion\": \"v17.0\",\n    \"systemPrompt\": \"Eres un asistente...\",\n    \"welcomeMessage\": \"Hola! Bienvenido...\",\n    \"welcomeImages\": [],\n    \"agentType\": 1\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/whatsapp-configs",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"whatsapp-configs"
							]
						},
						"description": "Crea una nueva configuración para una cuenta de WhatsApp."
					},
					"response": []
				},
				{
					"name": "List Configs",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/whatsapp-configs",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"whatsapp-configs"
							]
						},
						"description": "Lista todas las configuraciones de WhatsApp activas."
					},
					"response": []
				},
				{
					"name": "Get Config by Phone ID",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/whatsapp-configs/1234567890",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"whatsapp-configs",
								"1234567890"
							]
						},
						"description": "Obtiene una configuración específica por su Phone Number ID."
					},
					"response": []
				},
				{
					"name": "Update Config",
					"request": {
						"method": "PUT",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"name\": \"Tienda Demo Updated\",\n    \"systemPrompt\": \"Eres un asistente experto...\",\n    \"agentType\": 2\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/whatsapp-configs/{{configMongoId}}",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"whatsapp-configs",
								"{{configMongoId}}"
							]
						},
						"description": "Actualiza una configuración existente usando su ID de MongoDB."
					},
					"response": []
				},
				{
					"name": "Delete Config",
					"request": {
						"method": "DELETE",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/whatsapp-configs/{{configMongoId}}",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"whatsapp-configs",
								"{{configMongoId}}"
							]
						},
						"description": "Elimina una configuración existente."
					},
					"response": []
				}
			]
		},
		{
			"name": "User Authorization",
			"item": [
				{
					"name": "Authorize Number",
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"phoneNumber\": \"51975760418\",\n    \"flowId\": 1\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/users/authorize",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"users",
								"authorize"
							]
						},
						"description": "Autoriza un número de teléfono y le asigna un flujo."
					},
					"response": []
				},
				{
					"name": "List Authorized Numbers",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/users/authorized",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"users",
								"authorized"
							]
						},
						"description": "Lista todos los números autorizados actualmente."
					},
					"response": []
				}
			]
		},
		{
			"name": "WhatsApp Webhook",
			"item": [
				{
					"name": "Verify Webhook (GET)",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/whatsapp/webhook?hub.mode=subscribe&hub.verify_token={{verifyToken}}&hub.challenge=CHALLENGE_ACCEPTED",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"whatsapp",
								"webhook"
							],
							"query": [
								{
									"key": "hub.mode",
									"value": "subscribe"
								},
								{
									"key": "hub.verify_token",
									"value": "{{verifyToken}}"
								},
								{
									"key": "hub.challenge",
									"value": "CHALLENGE_ACCEPTED"
								}
							]
						},
						"description": "Simula el proceso de verificación de Webhook. El sistema verificará el token contra todas las configuraciones registradas."
					},
					"response": []
				},
				{
					"name": "Simulate Message (POST)",
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"object\": \"whatsapp_business_account\",\n  \"entry\": [\n    {\n      \"id\": \"{{wabaId}}\",\n      \"changes\": [\n        {\n          \"value\": {\n            \"messaging_product\": \"whatsapp\",\n            \"metadata\": {\n              \"display_phone_number\": \"{{accountPhoneNumber}}\",\n              \"phone_number_id\": \"{{phoneNumberId}}\"\n            },\n            \"contacts\": [\n              {\n                \"profile\": {\n                  \"name\": \"Cliente de Prueba\"\n                },\n                \"wa_id\": \"51999888777\"\n              }\n            ],\n            \"messages\": [\n              {\n                \"from\": \"51999888777\",\n                \"id\": \"wamid.{{randomId}}\",\n                \"timestamp\": \"1670605920\",\n                \"text\": {\n                  \"body\": \"Hola, qué productos tienes?\"\n                },\n                \"type\": \"text\"\n              }\n            ]\n          },\n          \"field\": \"messages\"\n        }\n      ]\n    }\n  ]\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/whatsapp/webhook",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"whatsapp",
								"webhook"
							]
						},
						"description": "Simula la recepción de un mensaje. Asegúrate de que el phoneNumberId coincida con una configuración registrada."
					},
					"response": []
				}
			]
		}
	],
	"variable": [
		{
			"key": "baseUrl",
			"value": "http://localhost:3000",
			"type": "string"
		},
		{
			"key": "verifyToken",
			"value": "tokentest",
			"type": "string"
		},
		{
			"key": "phoneNumberId",
			"value": "1234567890",
			"type": "string"
		},
		{
			"key": "configMongoId",
			"value": "65ae...",
			"type": "string"
		}
	]
}
